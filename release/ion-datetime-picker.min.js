!function(){"use strict";angular.module("ion-datetime-picker",["ionic"]).directive("ionDatetimePicker",function(){return{restrict:"AE",require:"ngModel",scope:{modelDate:"=ngModel",title:"=?",subTitle:"=?",buttonOk:"=?",buttonCancel:"=?",monthStep:"=?",hourStep:"=?",minuteStep:"=?",secondStep:"=?",onlyValid:"=?",operation:"=?",period:"=?",availableDays:"=?",format:"=?",times:"=?",callback:"&",optionPhrase:"=?"},controller:["$scope","$ionicPopup","$ionicPickerI18n","$timeout","$log","$attrs",function(e,t,n,i,a,o){function l(e){var t;for(t in e)return!1;return!0}function s(t,n){e.previousValidDay=t,n=n||0,0!==n&&t.setDate(t.getDate()+n),v.year=t.getFullYear(),v.month=t.getMonth(),v.day=t.getDate(),v.hour=t.getHours(),v.minute=t.getMinutes(),v.second=t.getSeconds(),v.date=t}function d(){var t=new Date(e.year,e.month,e.day,e.hour,e.minute,e.second);e.isEnabled(t.getDate(),!0)?s(t):(e.year=v.year,e.month=v.month,e.day=v.day),e.setDefaultSelection(t)}function r(t,n){if(!e.operation)return!0;var i=new Date(e.year,e.month,e.day),a=e.operations[i.getDay()];if(!a)return!0;var o=a.OpeningAt.split(":")[0],l=a.OpeningAt.split(":")[1],s=new Date,d=new Date,r=new Date;r.setHours(t,n),s.setHours(o,l);var c=a.ClosingAt.split(":")[0],u=a.ClosingAt.split(":")[1];return d.setHours(c,u),r>=s&&r<=d}function c(e){var t=new Date(e),n=isNaN(t.getTime());return n&&(t=new Date),t.setHours(0,0,0,0,0),t}function u(t,n){if(e.operations&&e.operations[t]){var i=e.operations[t],a=i.OpeningAt.split(":")[0],o=i.OpeningAt.split(":")[1];n?(e.hour=a,e.minute=o):e.previousValidDay||(v.hour=a,v.minute=o)}}function m(t,n,i,a){if(a&&e.validDays.length>0)return void u(e.validDays[0].getDay());var o=0,l=new Date(i.getTime()),d=new Date(i.getTime());do{if(l.setDate(l.getDate()+o),d.setDate(d.getDate()-o),e.operations[l.getDay()]&&l<=n){s(l,0),u(l.getDay()),e.setDefaultSelection(l);break}if(e.operations[d.getDay()]&&d>=t){s(d,0),u(d.getDay()),e.setDefaultSelection(d);break}o++}while(l<=n||d>=t)}if(e.lib={Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6,Sunday:0},e.defaultFormat="YYYY-MM-DD",e.validDays=[],e.operations={},e.availableDaysMap={},e.previousValidDay="",e.selectedTime={value:""},e.availableDays){var p=e.format?e.format:e.defaultFormat;angular.forEach(e.availableDays,function(t){e.availableDaysMap[moment(t.date).format(p)]=t.times})}e.operation&&(e.validDayOfWeek={},angular.forEach(e.operation,function(t){e.validDayOfWeek[e.lib[t.DaysOfWeek]]=!0})),e.inclusion=!!e.inclusion&&e.inclusion,e.dropdownEnabled=!!e.times,e.selectTime=function(){var t=e.selectedTime.value;e.hour=t.split(":")[0],e.minute=t.split(":")[1],e.previousValidDay&&e.previousValidDay.setHours(e.hour,e.minute),v.hour=e.hour,v.minute=e.minute},e.setupOperation=function(){e.operation&&angular.forEach(e.operation,function(t){e.operations[e.lib[t.DaysOfWeek]]=t})},l(e.operations)&&e.setupOperation(),e.i18n=n,e.bind={},e.rows=[0,1,2,3,4,5],e.cols=[1,2,3,4,5,6,7],e.weekdays=[0,1,2,3,4,5,6];var v={year:e.year,month:e.month,day:e.day,hour:e.hour,minute:e.minute,second:e.second,date:new Date,getDateWithoutTime:function(){var e=new Date(this.date);return e.setHours(0,0,0,0,0),e}};e.showPopup=function(){var n=new Date(e.year,e.month,e.day,e.hour,e.minute,e.second);e.setDefaultSelection(n),t.show({templateUrl:"lib/ion-datetime-picker/src/picker-popup.html",title:e.title||"Pick "+(e.dateEnabled?"a date":"")+(e.dateEnabled&&e.timeEnabled?" and ":"")+(e.timeEnabled?"a time":""),subTitle:e.subTitle||"",scope:e,cssClass:"ion-datetime-picker-popup",buttons:[{text:e.buttonOk||e.i18n.ok,type:"button-positive",onTap:function(){e.commit()}},{text:e.buttonCancel||e.i18n.cancel,type:"button-stable",onTap:function(){i(function(){e.processModel()},200)}}]})},e.prepare=function(){e.mondayFirst&&e.weekdays.push(e.weekdays.shift())},e.setDefaultSelection=function(t){var n=moment(e.hour+e.minute,"hhmm").format("HH:mm");if(l(e.operations)){if(e.availableDays){var i=e.format?e.format:e.defaultFormat,a=moment(t).format(i);e.times=e.availableDaysMap[a],e.times=e.times?e.times:e.availableDaysMap[moment(e.previousValidDay).format(i)],e.times&&e.times.length>=0?e.times.indexOf(n)===-1?(e.hour=e.times[0].split(":")[0],e.minute=e.times[0].split(":")[1],e.selectedTime.value=e.times[0]):(e.hour=n.split(":")[0],e.minute=n.split(":")[1],e.selectedTime.value=n):e.setPreviousTime()}}else{var o=e.operations[t.getDay()];if(o){var s=o.OpeningAt,d=o.ClosingAt;e.times=e.makeTimeIntervals(s,d,15),e.times.indexOf(n)===-1?(e.hour=s.split(":")[0],e.minute=s.split(":")[1],e.selectedTime.value=s):(e.hour=n.split(":")[0],e.minute=n.split(":")[1],e.selectedTime.value=n)}else e.setPreviousTime()}},e.setPreviousTime=function(){e.previousValidDay&&(console.log("$scope.previousValidDay "+e.previousValidDay),e.minute=moment(e.previousValidDay,e.foramt+"hh:mm").format("mm"),e.selectedTime.value=moment(e.hour+e.minute,"hhmm").format("HH:mm"))},e.processModel=function(){var t=new Date;e.year=e.dateEnabled?t.getFullYear():0,e.month=e.dateEnabled?t.getMonth():0,e.day=e.dateEnabled?t.getDate():0,e.hour=e.timeEnabled?t.getHours():0,e.minute=e.timeEnabled?t.getMinutes():0;var n=e.operations[t.getDay()];n&&(e.hour=n.OpeningAt.split(":")[0],e.minute="00"===n.OpeningAt.split(":")[1]?0:n.OpeningAt.split(":")[1]),e.setDefaultSelection(t),e.second=e.secondsEnabled?t.getSeconds():0,y()};var y=function(){d();var t=new Date(e.year,e.month,e.day,e.hour,e.minute,e.second);e.dateEnabled&&(e.year=t.getFullYear(),e.month=t.getMonth(),e.day=t.getDate(),e.bind.year=e.year,e.bind.month=e.month,e.firstDay=new Date(e.year,e.month,1).getDay(),e.mondayFirst&&(e.firstDay=(e.firstDay||7)-1),e.daysInMonth=b(e.year,e.month)),e.timeEnabled&&(e.hour=t.getHours(),e.minute=t.getMinutes(),e.second=t.getSeconds(),e.meridiem=e.hour<12?"AM":"PM",e.bind.hour=e.meridiemEnabled?(e.hour%12||12).toString():e.hour.toString(),e.bind.minute=(e.minute<10?"0":"")+e.minute.toString(),e.bind.second=(e.second<10?"0":"")+e.second.toString(),e.bind.meridiem=e.meridiem)},b=function(e,t){return new Date(e,t+1,0).getDate()};e.changeBy=function(t,n){if(+t){if(("hour"===n||"minute"===n)&&t===-1){var i=new Date(e.year,e.month,e.day,e.hour-1,e.minute);0!==e.minute&&"hour"!==n||e.hour!==i.getHours()||e.hour--}e[n]+=+t,r(e.hour,e.minute)||(e[n]-=+t),e.timePeriodEnabled&&e.getNextPageSelection(t),"month"!==n&&"year"!==n||e.timePeriodEnabled||(e.day=Math.min(e.day,b(e.year,e.month))),y()}},e.getNextPageSelection=function(t){var n=!0;if(e.availableDaysMap&&angular.forEach(e.availableDaysMap,function(t,i){if(n){var a=moment(i).format("MM");a===e.month+1+""&&(e.day=moment(i).format("DD"),n=!1)}}),e.period){var i,a=moment(e.period.to),o=moment(e.period.from),l=moment(new Date(e.year,e.month,1)),s=moment(new Date(e.year,e.month,b(e.year,e.month)));if(t>0){do i=l.format("E"),e.validDayOfWeek[i]&&(n=!1,e.day=l.format("DD")),l=l.add(1,"d");while(l<=a&&n)}else do i=s.format("E"),e.validDayOfWeek[i]&&(n=!1,e.day=s.format("DD")),s=s.add(-1,"d");while(s>=o&&n)}},e.change=function(t){var n=e.bind[t];n&&"meridiem"===t?(n=n.toUpperCase(),"AM"===n&&"PM"===e.meridiem?e.hour-=12:"PM"===n&&"AM"===e.meridiem&&(e.hour+=12),y()):(+n||0===+n)&&(e[t]=+n,"month"!==t&&"year"!==t||(e.day=Math.min(e.day,b(e.year,e.month))),y())},e.changeDay=function(t){e.day=t;new Date(e.year,e.month,t);y()},e.isEnabled=function(t,n){var i,a,o=new Date(e.year,e.month,t),l=!0,d=v.getDateWithoutTime(),r=o.getDay();if(e.availableDays){var u=e.format?e.format:e.defaultFormat,p=moment(o).format(u);l=!1;for(var y=0;y<e.availableDays.length;y++)if(p===moment(e.availableDays[y].date).format(u)){l=!0;break}l||(s(e.previousValidDay?e.previousValidDay:c(e.availableDays[0].date),0),e.setDefaultSelection(e.previousValidDay?e.previousValidDay:c(e.availableDays[0].date)))}else if(e.operation){var b,h;if(e.period.from&&e.period.to?(b=c(e.period.from),h=c(e.period.to),l=o>=b&&o<=h):e.period.from&&!e.period.to?(h=c(e.period.to),l=o>=b):!e.period.from&&e.to?(b=c(e.period.from),l=o<=h):l=!0,l&&!e.operations[r])return m(b,h,o,!0),!1;!l&&n&&o>=h?e.previousValidDay?s(e.previousValidDay,0):m(b,h,h,!1):!l&&n&&o<=b?e.previousValidDay?s(e.previousValidDay,0):m(b,h,b,!1):e.validDays.push(o)}else if(e.onlyValid&&e.onlyValid.after){var g=c(e.onlyValid.after);e.onlyValid.inclusive?(l=o>=g,!l&&n&&s(g,0)):(l=o>g,!l&&n&&s(g,1))}else if(e.onlyValid&&e.onlyValid.before){var f=c(e.onlyValid.after);e.onlyValid.inclusive?(l=o<=f,!l&&n&&s(f,0)):(l=o<f,!l&&n&&s(f,-1))}else e.onlyValid&&e.onlyValid.between?(i=c(e.onlyValid.between.initial),a=c(e.onlyValid.between["final"]),e.onlyValid.inclusive?(l=o>=i&&o<=a,!l&&n&&(o<i&&s(i,0),o>a&&s(a,0))):(l=o>i&&o<a,!l&&n&&(o<=i&&s(i,1),o>=a&&s(a,-1)))):e.onlyValid&&e.onlyValid.outside&&(i=c(e.onlyValid.outside.initial),a=c(e.onlyValid.outside["final"]),e.onlyValid.inclusive?(l=o<=i||o>=a,!l&&n&&(d<=i&&s(a,0),d>=a&&s(i,0))):(l=o<i||o>a,!l&&n&&(d<i&&s(a,1),d>a&&s(i,-1))));return l},e.changed=function(){y()},e.makeTimeIntervals=function(e,t,n){var i=t;e=e.toString().split(":"),t=t.toString().split(":"),n=parseInt(n,10);var a=function(e){return e<10?"0"+e.toString():e},o=parseInt(e[0],10),l=parseInt(e[1],10),s=parseInt(t[0],10),d=(parseInt(t[1],10),o),r=l,c=(d<10?"0"+d:d)+":"+a(r),u="",m=[];do r+=n,(r%60===0||r>60)&&(r=60===r?0:r-60,d+=1),u=d<10?"0"+d+":"+a(r):d+":"+a(r),m.push(c),c=u;while(d<s||c<s);return m.push(i),m},e.dateEnabled&&e.$watch(function(){return(new Date).getDate()},function(){var t=new Date;e.today={day:t.getDate(),month:t.getMonth(),year:t.getFullYear()}})}],link:function(e,t,n,i){e.$watch("model",function(){e.$eval(n.ngModel+" = modelDate")}),e.$watch(n.ngModel,function(t){e.modelDate=t}),e.dateEnabled="date"in n&&"false"!==n.date,e.timeEnabled="time"in n&&"false"!==n.time,e.timePeriodEnabled=!!n.availableDays||!!n.period||!!n.operation,e.dateEnabled===!1&&e.timeEnabled===!1&&(e.dateEnabled=e.timeEnabled=!0),e.mondayFirst="mondayFirst"in n&&"false"!==n.mondayFirst,e.secondsEnabled=e.timeEnabled&&"seconds"in n&&"false"!==n.seconds,e.meridiemEnabled=e.timeEnabled&&"amPm"in n&&"false"!==n.amPm,e.monthStep=+e.monthStep||1,e.hourStep=+e.hourStep||1,e.minuteStep=+e.minuteStep||1,e.secondStep=+e.secondStep||1,e.prepare(),i.$render=function(){e.modelDate=i.$viewValue,e.processModel()},e.commit=function(){e.modelDate=new Date(e.year,e.month,e.day,e.hour,e.minute,e.second),i.$setViewValue(e.modelDate),e.callback({callback:e.modelDate})},t.on("click",e.showPopup)}}}),angular.module("ion-datetime-picker").factory("$ionicPickerI18n",["$window",function(e){return{ok:"OK",cancel:"Cancel",okClass:"button-positive",cancelClass:"button-stable",weekdays:e.moment?e.moment.weekdaysMin():["Su","Mo","Tu","We","Th","Fr","Sa"],months:e.moment?e.moment.months():["January","February","March","April","May","June","July","August","September","October","November","December"]}}]),angular.module("ion-datetime-picker").run(["$templateCache",function(e){e.put("lib/ion-datetime-picker/src/picker-popup.html",'<div class="ion-datetime-picker"><div ng-if-start="dateEnabled" class="row month-year"><div class="col col-10 left-arrow"><button type="button" class="button button-small button-positive button-clear icon ion-chevron-left" ng-click="changeBy(-monthStep, \'month\')"></button></div><label class="col col-50 month-input"><div class="item item-input item-select"><select ng-model="bind.month" ng-options="i18n.months.indexOf(month) as month for month in i18n.months" ng-change="change(\'month\')"></select></div></label> <label class="col year-input"><div class="item item-input" ng-show="!timePeriodEnabled"><div><input type="number" ng-model="bind.year" min="1900" max="2999" ng-change="change(\'year\')" ng-blur="changed()" required=""></div></div><div class="item item-input time-period" ng-show="timePeriodEnabled"><div><label>{{bind.year}}</label></div></div></label><div class="col col-10 right-arrow"><button type="button" class="button button-small button-positive button-clear icon ion-chevron-right" ng-click="changeBy(+monthStep, \'month\')"></button></div></div><div class="row calendar weekdays"><div class="col" ng-repeat="weekday in weekdays"><div class="weekday">{{i18n.weekdays[weekday]}}</div></div></div><div ng-if-end="" class="row calendar days" ng-repeat="y in rows"><div class="col" ng-repeat="x in cols"><div ng-show="(cellDay = y * 7 + x - firstDay) > 0 && cellDay <= daysInMonth" ng-click="changeDay(cellDay)" class="day" ng-class="{ \'disabled\': !isEnabled(cellDay), \'selected\': cellDay === day, \'today\': cellDay === today.day && month === today.month && year === today.year }">{{cellDay}}</div></div></div><div ng-if="timePeriodEnabled"><label class="item item-input item-select item-icon"><i class="fa fa-calendar placeholder-icon"></i><select name="setDropOffTime" class="inlineIcon" ng-model="selectedTime.value" ng-change="selectTime()"><option value="" selected="">{{optionPhrase}}</option><option ng-repeat="value in times" ng-selected="value === selectedTime.value" value="{{value}}">{{value}}</option></select></label></div><div ng-if-start="timeEnabled" class="row time-buttons"><div class="col"></div><div class="col-20"><button type="button" class="button button-positive button-clear icon ion-chevron-up" ng-click="changeBy(+hourStep, \'hour\')"></button></div><div class="col"></div><div class="col-20"><button type="button" class="button button-positive button-clear icon ion-chevron-up" ng-click="changeBy(+minuteStep, \'minute\')"></button></div><div ng-if-start="secondsEnabled" class="col"></div><div ng-if-end="" class="col-20"><button type="button" class="button button-positive button-clear icon ion-chevron-up" ng-click="changeBy(+secondStep, \'second\')"></button></div><div ng-if-start="meridiemEnabled" class="col"></div><div ng-if-end="" class="col-20"><button type="button" class="button button-positive button-clear icon ion-chevron-up" ng-click="changeBy(+12, \'hour\')"></button></div><div class="col"></div></div><div class="row time"><div class="col"></div><label class="col col-20"><div class="item item-input"><div><input type="text" ng-model="bind.hour" pattern="0?([01]?[0-9]|2[0-3])" ng-change="change(\'hour\')" ng-blur="changed()" required=""></div></div></label><div class="col colon">:</div><label class="col col-20"><div class="item item-input"><div><input type="text" ng-model="bind.minute" pattern="0?[0-5]?[0-9]" ng-change="change(\'minute\')" ng-blur="changed()" required=""></div></div></label><div ng-if-start="secondsEnabled" class="col colon">:</div><label ng-if-end="" class="col col-20"><div class="item item-input"><div><input type="text" ng-model="bind.second" pattern="0?[0-5]?[0-9]" ng-change="change(\'second\')" ng-blur="changed()" required=""></div></div></label><div ng-if-start="meridiemEnabled" class="col"></div><label ng-if-end="" class="col col-20"><div class="item item-input"><div><input type="text" ng-model="bind.meridiem" pattern="[aApP][mM]" ng-change="change(\'meridiem\')" ng-blur="changed()" required=""></div></div></label><div class="col"></div></div><div ng-if-end="" class="row time-buttons"><div class="col"></div><div class="col-20"><button type="button" class="button button-positive button-clear icon ion-chevron-down" ng-click="changeBy(-hourStep, \'hour\')"></button></div><div class="col"></div><div class="col-20"><button type="button" class="button button-positive button-clear icon ion-chevron-down" ng-click="changeBy(-minuteStep, \'minute\')"></button></div><div ng-if-start="secondsEnabled" class="col"></div><div ng-if-end="" class="col-20"><button type="button" class="button button-positive button-clear icon ion-chevron-down" ng-click="changeBy(-secondStep, \'second\')"></button></div><div ng-if-start="meridiemEnabled" class="col"></div><div ng-if-end="" class="col-20"><button type="button" class="button button-positive button-clear icon ion-chevron-down" ng-click="changeBy(-12, \'hour\')"></button></div><div class="col"></div></div></div>')}])}();